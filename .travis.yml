language: node_js
#elm-format: 0.8.4
#elm-test: 0.19.1
node_js: "14"
dist: focal
before_script:
  - yarn global add elm-test@0.19.1-revision6
  - yarn global add elm-format@0.8.4
jobs:
  include:
    - stage: test
      script: yarn test
    - stage: deploy
      script: yarn prod && tar -zcvf elm-ninja.tar.gz dist
      deploy:
        provider: releases
        cleanup: false
        skip_cleanup: true #cleanup option not working, build suggesting this.
        token: $GITHUB_TOKEN
        file: elm-ninja.tar.gz
        on:
          branch: master
stages:
  - test
  - name: deploy
    if: branch = master